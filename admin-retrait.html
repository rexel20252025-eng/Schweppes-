<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Green - Approbation des Retraits</title>
    
    <style>
        /* Reset et styles de base */
        * {
            margin: 0;
            padding: 0;
           box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        /* Layout Components */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Filtres */
        .filtres {
            background: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filtre-groupe {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Form Elements */
        .filtre-groupe label {
            font-weight: 600;
            color: #2c3e50;
        }

        input, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #0d6efd;
        }

        /* Statistics */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-item {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-valeur {
            font-size: 1.8em;
            font-weight: bold;
            color: #0d6efd;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }

        /* Withdrawal Cards */
        .retrait {
            background: #fff;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .retrait:hover {
            transform: translateY(-2px);
        }

        .info-user {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .montant {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin: 15px 0;
        }

        .details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .detail {
            margin: 8px 0;
            color: #495057;
        }

        /* Buttons */
        .boutons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-approuver {
            background: #28a745;
            color: white;
        }

        .btn-rejeter {
            background: #dc3545;
            color: white;
        }

        .btn-filtre {
            background: #0d6efd;
            color: white;
        }

        .btn-supprimer {
            background: #6c757d;
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            width: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-boutons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        /* Status and Highlights */
        .en-attente {
            color: #ffc107;
            font-weight: 600;
        }

        .highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* Debug Information */
        .debug-info {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            font-family: monospace;
            line-height: 1.4;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .filtres {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .boutons {
                flex-direction: column;
            }

            .modal-content {
                width: 90%;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Demandes de Retrait</h1>
        </div>

        <div class="filtres">
            <div class="filtre-groupe">
                <label>Date de d√©but</label>
                <input type="date" id="date-debut">
            </div>
            <div class="filtre-groupe">
                <label>Date de fin</label>
                <input type="date" id="date-fin">
            </div>
            <div class="filtre-groupe">
                <label>√âtat</label>
                <select id="statut-filtre">
                    <option value="En attente">En attente</option>
                    <option value="Approuv√©">Approuv√©</option>
                    <option value="Rejet√©">Rejet√©</option>
                    <option value="">Tous les √©tats</option>
                </select>
            </div>
            <div class="filtre-groupe">
                <label>Rechercher</label>
                <input 
                    type="text" 
                    id="recherche" 
                    placeholder="Nom, t√©l√©phone, op√©rateur..."
                >
            </div>
            <div class="filtre-groupe">
                <button class="btn btn-filtre" onclick="window.reinitialiserFiltres()">
                    R√©initialiser les filtres
                </button>
                <button class="btn btn-supprimer" onclick="window.ouvrirModalSuppression()">
                    Supprimer l'historique
                </button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-valeur" id="total-retraits">0</div>
                <div class="stat-label">Total des retraits</div>
            </div>
            <div class="stat-item">
                <div class="stat-valeur" id="montant-total">0 FCFA</div>
                <div class="stat-label">Montant total</div>
            </div>
            <div class="stat-item">
                <div class="stat-valeur" id="retraits-periode">0</div>
                <div class="stat-label">Retraits filtr√©s</div>
            </div>
        </div>

        <div id="modal-suppression" class="modal">
            <div class="modal-content">
                <h2>Confirmation</h2>
                <p>Voulez-vous vraiment supprimer tout l'historique des retraits ?</p>
                <div class="modal-boutons">
                    <button class="btn btn-rejeter" onclick="window.annulerSuppression()">Annuler</button>
                    <button class="btn btn-approuver" onclick="window.supprimerHistorique()">Confirmer</button>
                </div>
            </div>
        </div>

        <div id="debug" class="debug-info"></div>
        <div id="liste-retraits"></div>
    </div>

 <script type="module">
// Import des modules Firebase n√©cessaires
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { 
    getDatabase, 
    ref, 
    get, 
    set, 
    update,
    onValue,
    query,
    orderByChild,
    equalTo,
    push
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
import { getStorage } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

// üîÅ CONFIG FIREBASE ‚Äî SCHWEPPES
const firebaseConfig = {
    apiKey: "AIzaSyATz_ogu08DUoKSYKy6t2cHWdleUD-Fbrk",
    authDomain: "schweppes-15df3.firebaseapp.com",
    databaseURL: "https://schweppes-15df3-default-rtdb.firebaseio.com",
    projectId: "schweppes-15df3",
    storageBucket: "schweppes-15df3.firebasestorage.app",
    messagingSenderId: "1011077098372",
    appId: "1:1011077098372:web:64f9ad3a8e93f68c070bd1"
};   

// Initialisation Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// √âtat global
let tousLesRetraits = [];
let filtresActifs = {
    dateDebut: null,
    dateFin: null,
    recherche: '',
    statut: 'En attente'
};

// Utilitaires
const formatDate = (timestamp) => new Date(timestamp).toLocaleString('fr-FR');
const formatMontant = (montant) => (montant || 0).toLocaleString();

function surlignerTexte(texte, recherche) {
    if (!recherche) return texte;
    const regex = new RegExp(`(${recherche})`, 'gi');
    return texte.toString().replace(regex, '<span class="highlight">$1</span>');
}

// Fonctions de mise √† jour de l'interface
function afficherDebug(message) {
    const debug = document.getElementById('debug');
    debug.innerHTML += `<div>${message}</div>`;
    console.log(message);
}

// ‚Ä¶ (le reste de ton code reste identique, aucune modification n√©cessaire)

// Chargement des donn√©es depuis Schweppes
async function chargerRetraits() {
    const retraitsRef = ref(db, 'users');
    
    onValue(retraitsRef, (snapshot) => {
        // R√©initialisation
        document.getElementById('liste-retraits').innerHTML = '';
        document.getElementById('debug').innerHTML = '';
        tousLesRetraits = [];
        
        afficherDebug('Connexion √† Firebase Schweppes r√©ussie');
        
        if (snapshot.exists()) {
            afficherDebug('Donn√©es trouv√©es dans users');
            
            snapshot.forEach((userSnapshot) => {
                const userData = userSnapshot.val();
                const userId = userSnapshot.key;
                
                if (userData.withdrawalHistory) {
                    Object.entries(userData.withdrawalHistory).forEach(([retraitId, retrait]) => {
                        retrait.userId = userId;
                        retrait.retraitId = retraitId;
                        retrait.username = userData.username || userData.email || 'Utilisateur sans nom';
                        retrait.status = retrait.status || 'En attente';
                        retrait.operator = userData.withdrawalConfig?.operator || 'Non sp√©cifi√©';
                        retrait.phone = userData.withdrawalConfig?.phone || 'Non sp√©cifi√©';
                        tousLesRetraits.push(retrait);
                    });
                }
            });

            filtresActifs.statut = 'En attente';
            document.getElementById('statut-filtre').value = 'En attente';
            filtrerRetraitsAvance();
        } else {
            afficherDebug('Aucune donn√©e trouv√©e dans users');
            mettreAJourStatistiques([]);
        }
    }, (error) => {
        afficherDebug(`Erreur de connexion: ${error.message}`);
        console.error('Erreur:', error);
    });
}

// Gestionnaires d'√©v√©nements et fonctions globales restent identiques
document.addEventListener('DOMContentLoaded', () => {
    // ‚Ä¶
    chargerRetraits();
});
</script>
</body>
</html>